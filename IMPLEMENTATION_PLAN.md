# 授業口コミサイト 実装計画書

## 1. プロジェクトのゴール
`docs/DESIGN.md` に基づく授業口コミサイトを、開発環境で動作する形で完成させる。
各機能の実装と並行して、Playwright (TypeScript) を用いたE2E（エンドツーエンド）テストを作成し、テスト駆動開発の学習も行う。

## 2. 全体方針
- **環境**: 開発環境（ローカル）での動作を前提とし、本番環境固有の考慮（PostgreSQL, デプロイ等）は除外する。
- **データベース**: `SQLite` を使用する。
- **テスト**:
    - **E2Eテスト**: Playwright (TypeScript) を使用する。機能実装後に、ユーザー操作をシミュレートするテストを作成し、機能の正しさを保証する。
    - **テストサイクル**: `機能実装 → E2Eテスト作成 → テスト成功` のサイクルで開発を進める。

## 3. 実装フェーズ

### フェーズ 0: スタイリング
このフェーズでは、TailwindCSSを導入し、基本的なデザインを適用します。

- **タスク 0.1: TailwindCSSのセットアップ**
    - [x] `tailwindcss-rails` gem をインストール
    - [x] `bundle install`
    - [x] `./bin/rails tailwindcss:install` を実行
- **タスク 0.2: 基本レイアウトのスタイリング**
    - [x] `app/views/layouts/application.html.erb` のスタイリング
    - [x] ヘッダー、フッター、ナビゲーションの作成
    - [x] サイト全体のフォント、色、スペーシングを統一

### フェーズ 1: 環境構築
このフェーズでは、開発とテストに必要な環境を整備します。

- **タスク 1.1: Playwright (TypeScript) のセットアップ**
    - [x] `npm` を利用してPlaywrightをプロジェクトに導入する。
    - [x] E2Eテストコードを管理するためのディレクトリ（例: `e2e-tests`）を作成する。
    - [x] `playwright.config.ts` を設定し、テスト対象のURL（`baseURL`）をRailsサーバー（`http://localhost:3000`）に向ける。
- **タスク 1.2: サンプルE2Eテストの作成と実行**
    - [x] Railsのトップページが正常に表示されることを確認する簡単なテストを作成し、Playwrightのセットアップが正しく完了したことを検証する。

### フェーズ 2: データモデルの構築 (バックエンド)
設計書に基づき、アプリケーションの土台となるデータベースとモデルを構築します。

- **タスク 2.1: モデルとマイグレーションの生成**
    - [x] `rails g model` コマンドで `User`, `Course`, `Review`, `ReviewReaction` の4モデルを生成する。
- **タスク 2.2: マイグレーションファイルの修正**
    - [x] 生成されたマイグレーションファイルに、設計書通りの制約（`null: false`, `default`値, `unique`制約）を追加する。
- **タスク 2.3: データベースの作成**
    - [x] `rails db:migrate` を実行してテーブルを作成する。
- **タスク 2.4: モデルの関連付けとバリデーション設定**
    - [x] 各モデルファイル (`app/models/*.rb`) に `has_many`, `belongs_to` の関連付けと、データの整合性を保つためのバリデーションを記述する。

### フェーズ 3: 認証機能の実装とテスト
ユーザーが登録・ログイン・ログアウトできる機能を作成し、E2Eテストで動作を保証します。

- **タスク 3.1: 機能実装**
    - [x] `UsersController` を作成し、ユーザー登録画面と登録処理を実装する。
    - [x] `SessionsController` を作成し、ログイン・ログアウト処理を実装する。
    - [x] `config/routes.rb` に関連するルーティングを追加する。
    - [x] ユーザー登録画面とログイン画面のビューを作成する。
- **タask 3.2: E2Eテスト作成 (`auth.spec.ts`)**
    - [x] **テストケース1**: ユーザーが正常に新規登録できること。
    - [x] **テストケース2**: 登録済みのユーザーが正常にログインできること。
    - [x] **テストケース3**: ログイン中のユーザーが正常にログアウトできること。

### フェーズ 4: 授業と口コミのコア機能実装とテスト
アプリケーションの中核である、授業の閲覧と口コミの投稿・表示機能を実装します。

- **タスク 4.1: テストデータ準備**
    - [x] `db/seeds.rb` に、動作確認用の授業データを複数作成する。
    - [x] `rails db:seed` でデータを投入する。
- **タスク 4.2: 機能実装**
    - [x] `CoursesController` を作成し、授業一覧画面と授業詳細画面を実装する。
    - [x] `ReviewsController` を作成し、口コミ投稿フォームと投稿処理を実装する（`CoursesController` にネストさせる）。
    - [x] 関連するルーティングを追加する。
    - [x] 授業一覧、授業詳細、口コミ投稿フォームのビューを作成する。
- **タスク 4.3: E2Eテスト作成 (`course_review.spec.ts`)**
    - [x] **テストケース1**: トップページから授業一覧ページに遷移できること。
    - [x] **テストケース2**: 授業詳細ページに遷移でき、授業情報と口コミ一覧が表示されること。
    - [x] **テストケース3**: ログインユーザーが口コミを投稿し、その内容が授業詳細ページに反映されること。
    - [x] **テストケース4**: 未ログインユーザーが口コミを投稿しようとすると、ログインページにリダイレクトされること。

### フェーズ 5: 口コミ機能拡張
設計書の「口コミ機能」要件に基づき、既存の口コミ機能のさらなる拡張を行いました。

- [x] **口コミの詳細表示**: 個別のレビューページを実装し、より詳細な情報を表示できるようにしました。
- [x] **口コミの編集・削除（投稿者のみ）**: レビューの投稿者のみが自身の口コミを編集・削除できる機能を実装しました。
- [x] **口コミへの反応（役立った/役立たなかった）**: 各口コミに対してユーザーが「役立った」「役立たなかった」という反応を送信できる機能を実装しました。
- [x] **同一ユーザーは同じ授業に1つの口コミのみ投稿可能（ビジネスルール）**: 同じユーザーが同じ授業に複数の口コミを投稿できないようにするバリデーションと、関連するUIロジックを実装しました。

### Day 2: Reviewモデル実装
- [x] Reviewモデル実装
- [x] Reviewコントローラ実装
- [x] Reviewビュー実装
- [x] Reviewフィクスチャ追加

## 実装ログ

### Day 12: 口コミ詳細ページ実装
- [x] `feature/review-detail-page` ブランチを作成
- [x] 口コミ詳細ページのルーティング、コントローラ、ビューを実装
- [x] 授業詳細ページから口コミ詳細ページへのリンクを確認
- [x] 口コミの評価、本文、試験情報、アドバイスなどを表示
- [x] 投稿者本人にのみ編集・削除ボタンが表示されるように実装
- [x] 「役立った/役立たなかった」のリアクション機能を実装